Related articles: [[RPCclient]]
Tags: #Protocols #AnchorPoint 

---
# Main Ports: 139 and 445. 

## ðŸ“š Definition:
SMB had been invented by IBM around mid '80s. SMB stands for Server Message Block and is a protocol used in file/resource sharing over a network. It is highly downwards compatible.

Samba is the UNIX version of SMB. Samba implements the CIFS(Common Internet File System). Samba is basically a collection of applications and it permits communication with SMB enabled devices and can be assigned a Windows DC for a better user interaction.

## SMBclient - Connecting to the Share

```bash
â”Œâ”€â”€(czrã‰¿theHound)-[~]
â””â”€$ smbclient -N -L //10.13.13.55/     
Anonymous login successful

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        files           Disk      Mark's Files
        tom_share       Disk      
        IPC$            IPC       IPC Service (ubuntu01 server (Samba, Ubuntu))

```

| Flag | Description                                                 |
| ---- | ----------------------------------------------------------- |
| -N   | Stands for null-session and creates an anonymous mode sesh. |
| -L   | Will list the shares                                        |
Our limitations are based on the configuration of the smb/samba protocol.
One quick example is: 
```bash
â”Œâ”€â”€(czrã‰¿theHound)-[~/HTB]
â””â”€$ smbclient -N //10.13.13.55/tom_share    
Anonymous login successful
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Aug 22 10:07:04 2024
  ..                                  D        0  Thu Aug 22 10:07:04 2024
  file.txt                            N        5  Thu Aug 22 10:07:04 2024

		10218772 blocks of size 1024. 5145240 blocks available
smb: \> 

```
---

In the above example we are able to see that we can connect anonymously to the share and even list the dir.

Now:
```bash
â”Œâ”€â”€(czrã‰¿theHound)-[~/HTB]
â””â”€$ smbclient -N //10.13.13.55/files
Anonymous login successful
Try "help" to get a list of possible commands.
smb: \> ls
NT_STATUS_ACCESS_DENIED listing \*
smb: \> ls
NT_STATUS_ACCESS_DENIED listing \*
smb: \> dir
NT_STATUS_ACCESS_DENIED listing \*
```

Here we can see that even though we were able to successfully log-in anonymously we can not list the directory.
That's because of how the directory(share) permissions had been set-up on the Samba server.

After modification of directory permissions:
![[Pasted image 20240822190806.png]]
Both shares are now readable:
![[Pasted image 20240822190839.png]]

Other examples (read only modified in .conf):
```bash
smb: \> put test.txt
putting file test.txt as \test.txt (2.0 kb/s) (average 2.0 kb/s)
```

```bash
smb: \> put test.txt
NT_STATUS_ACCESS_DENIED opening remote file \test.txt
```

Other ways of interacting with SMB/Samba shares are through MS-RPC ([[RPC]]), respectively through [[RPCclient]] or with **Impacket's Samrdump.py** or with [[smbmap]] or with [[crackmapexec]] or with [[enum4linux]].

