Related articles:
Tags: #Protocols #AnchorPoint 

---

# COMMON PORTS: 2049

# ðŸ“š Definition:
NFS, like SAMBA is a file-sharing protocol. NFS is based on UNIX/LINUX and it can be easier and much simpler to configure than Samba.
It has been developed by Sun Microsystems.

It's configuration file resides in /etc/exports
![[Pasted image 20240824212623.png]]

The defaultÂ `exports`Â file also contains some examples of configuring NFS shares. First, the folder is specified and made available to others, and then the rights they will have on this NFS share are connected to a host or a subnet. Finally, additional options can be added to the hosts or subnets.

|**Option**|**Description**|
|---|---|
|`rw`|Read and write permissions.|
|`ro`|Read only permissions.|
|`sync`|Synchronous data transfer. (A bit slower)|
|`async`|Asynchronous data transfer. (A bit faster)|
|`secure`|Ports above 1024 will not be used.|
|`insecure`|Ports above 1024 will be used.|
|`no_subtree_check`|This option disables the checking of subdirectory trees.|
|`root_squash`|Assigns all permissions to files of root UID/GID 0 to the UID/GID of anonymous, which preventsÂ `root`Â from accessing files on an NFS mount.|

## Dangerous Settings
However, even with NFS, some settings can be dangerous for the company and its infrastructure. Here are some of them listed:

|**Option**|**Description**|
|---|---|
|`rw`|Read and write permissions.|
|`insecure`|Ports above 1024 will be used.|
|`nohide`|If another file system was mounted below an exported directory, this directory is exported by its own exports entry.|
|`no_root_squash`|All files created by root are kept with the UID/GID 0.|

It is highly recommended to create a local VM and experiment with the settings. We will discover methods that will show us how the NFS server is configured. For this, we can create several folders and assign different options to each one. Then we can inspect them and see what settings can have what effect on the NFS share and its permissions and the enumeration process.

We can take a look at theÂ `insecure`Â option. This is dangerous because users can use ports above 1024. The first 1024 ports can only be used by root. This prevents the fact that no users can use sockets above port 1024 for the NFS service and interact with it.

# Footprinting the Service

When footprinting NFS, the TCP portsÂ `111`Â andÂ `2049`Â are essential. We can also get information about the NFS service and the host via RPC, as shown below in the example.

# NMAP:
```bash
sudo nmap --script nfs* 10.129.14.128 -sV -p111,2049
```
![[Pasted image 20240824212813.png]]

# Show Available NFS Shares

```bash
0xCZR@htb[/htb]$ showmount -e 10.129.14.128

Export list for 10.129.14.128:
/mnt/nfs 10.129.14.0/24
```
![[Pasted image 20240824212934.png]]
# Mounting NFS Share

```bash
0xCZR@htb[/htb]$ mkdir target-NFS
0xCZR@htb[/htb]$ sudo mount -t nfs 10.129.14.128:/ ./target-NFS/ -o nolock
0xCZR@htb[/htb]$ cd target-NFS
0xCZR@htb[/htb]$ tree .

.
â””â”€â”€ mnt
    â””â”€â”€ nfs
        â”œâ”€â”€ id_rsa
        â”œâ”€â”€ id_rsa.pub
        â””â”€â”€ nfs.share

2 directories, 3 files
```

There we will have the opportunity to access the rights and the usernames and groups to whom the shown and viewable files belong. Because once we have the usernames, group names, UIDs, and GUIDs, we can create them on our system and adapt them to the NFS share to view and modify the files.

